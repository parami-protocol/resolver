<!doctype html>
<html>
  <head>
    <title>chain server</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 15px Helvetica, Arial; }
      .container {
        width: 1200px;
        margin: 20px auto;
      }
      .container button {
        margin: 10px;
      }
      button {
        border: none;
        background: #19be6b;
        color: #fff;
        outline: none;
        height: 45px;
        line-height: 45px;
        padding: 0 25px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <button class="create-genesis">初始化</button>
      <span>
        创建创世账号，创建初始群主DID，抵押PRA
      </span>
      <br>
      <button class="create-old">老账号</button>
      <button class="create-sns">社交账号</button>
      <button class="lock">抵押</button>
      <button class="unlock">赎回</button>
      <button class="test">Test</button>
    </div>
    <script src="https://cdn.bootcss.com/socket.io/2.2.0/socket.io.slim.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.slim.min.js"></script>
    <script>
      $(function() {
        const socket = io();
        $('.create-genesis').click(function() {
          console.log('create genesis')          
          // 创世账号
          const data = JSON.stringify({
            superior: '',
            address: '5CrRpNbQBTiBmTjpUgJ6mH9YRmopVweLsjffVz7muskYEo2r',
            pubkey: '0x22df4b685df33f070ae6e5ee27f745de078adff099d3a803ec67afe1168acd4f',
            didType: '1',
            socialAccount: 'newfeiyang'
          })
  
          socket.emit('create_by_old', data)
          
          // 创世群
          setTimeout(() => {
            const data = JSON.stringify({
              superior: '',
              address: '5CMDp8RSys5uBwct5XKY1rBtJtisTPuqZkxcbnho3jxWQJ51', // Airdrop
              pubkey: '0x0c98c49f1861d5f6ed9ea27230796a76878abbfbfb9716c64b2c7479a2197435',
              didType: '1',
              socialAccount: 'wxid_7h9gf2umzeja22', // pratest1111  般若超级节点
              socialSuperior: 'newfeiyang'
            })
    
            socket.emit('create_by_old', data)
          }, 4500)
        })
        
        $('.create-old').click(function() {
          const data = JSON.stringify({
            superior: '',
            address: '5CMDp8RSys5uBwct5XKY1rBtJtisTPuqZkxcbnho3jxWQJ51', // Airdrop
            pubkey: '0x0c98c49f1861d5f6ed9ea27230796a76878abbfbfb9716c64b2c7479a2197435',
            didType: '1',
            socialAccount: 'wxid_7h9gf2umzeja22', // pratest1111  般若超级节点
            socialSuperior: 'newfeiyang'
          })
          
          console.log('create old', data)
          socket.emit('create_by_old', data)
        })

        $('.create-sns').click(function() {
          console.log('create sns account')
          const data = JSON.stringify({
            didType: '1',
            sid: 'testwsgq',
            socialSuperior: 'wxid_7h9gf2umzeja22',
          })
  
          socket.emit('create_by_sns', data)
        })

        $('.lock').click(function() {
          const amount = 50 * Math.pow(10, 15)
          const data = JSON.stringify({
            address: '5CMDp8RSys5uBwct5XKY1rBtJtisTPuqZkxcbnho3jxWQJ51',
            method: 'lock',
            params: [amount, 10]
          })

          console.log(data, 'lock data')
          socket.emit('sign', data)
        })
        
        $('.unlock').click(function() {
          const amount = 50 * Math.pow(10, 15)

          const data = JSON.stringify({
            address: '5CMDp8RSys5uBwct5XKY1rBtJtisTPuqZkxcbnho3jxWQJ51',
            method: 'unlock',
            params: [amount]
          })

          console.log(data, 'unlock data')
          socket.emit('sign', data)
        })

        $('.test').click(function() {
          const amount = 0.01 * Math.pow(10, 15)
          const data = JSON.stringify({
            id: '123456789',
            did: 'did:pra:LuEBwxYKaTdNYfXYkM7uCumbbaAh6ks4JD',
            amount
          })

          
          for(let i=0;i < 100;i++) {
            socket.emit('kt', data)
          }
        })

        socket.on('connect', function() {
          console.log('connect successfully')

          socket.on('Created', msg => {
            console.log(msg, 'create succeed')
          })
  
          socket.on('tx_failed', msg => {
            console.log(msg, 'create failed')
          })
  
        })
  
        socket.on('disconnect', function(){
          console.log('disconnect')
        })

      })
    </script>
  </body>
</html>
